spring.application.name=security

# Port - Railway sẽ tự động set PORT env variable, fallback về 8083 cho local
server.port=${PORT:8083}

# Database - Sử dụng environment variables cho production, fallback về local cho development
# Railway PostgreSQL format: postgresql://user:password@host:port/dbname
# Cần convert sang JDBC format: jdbc:postgresql://host:port/dbname?user=user&password=password
spring.datasource.url=${DATABASE_URL:jdbc:mysql://localhost:3306/security_module}
spring.datasource.username=${DB_USERNAME:root}
spring.datasource.password=${DB_PASSWORD:huy12345}
spring.datasource.driver-class-name=${DB_DRIVER:com.mysql.cj.jdbc.Driver}

spring.jpa.hibernate.ddl-auto=update
spring.jpa.show-sql=true
spring.jpa.properties.hibernate.format_sql=true
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.MySQLDialect

# Redis Configuration (optional - for token caching)
spring.cache.type=redis
spring.data.redis.host=${REDIS_HOST:localhost}
spring.data.redis.port=${REDIS_PORT:6379}
spring.data.redis.password=${REDIS_PASSWORD:}

# JWT Configuration - Sử dụng env vars cho production
jwt.secret=${JWT_SECRET:5367566B59703373367639792F423F4528482B4D6251655468576D5A71347437}
jwt.expiration=${JWT_EXPIRATION:3600000}
jwt.refresh-expiration=${JWT_REFRESH_EXPIRATION:604800000}

# User Registration Saga Configuration
# Timeout cho user ở trạng thái PENDING (milliseconds)
# Default: 300000ms = 5 phút
user.registration.pending-timeout=300000
# Cron expression để chạy cleanup job (mặc định: mỗi 2 phút)
user.registration.cleanup-cron=0 */2 * * * ?

# ========================================
# LOGGING CONFIGURATION
# ========================================

# Root logging level
logging.level.root=DEBUG

# Spring Boot internal logging (giảm noise)
logging.level.org.springframework=WARN
logging.level.org.hibernate=WARN
logging.level.org.apache=WARN

# Database connection pool logging
logging.level.com.zaxxer.hikari=WARN
logging.level.com.zaxxer.hikari.pool=WARN

# Redis client logging
logging.level.io.lettuce=WARN
logging.level.io.netty=WARN

# JDK security logging
logging.level.jdk.event.security=WARN

# MySQL driver logging
logging.level.com.mysql=WARN

# JMX/RMI logging (monitoring tools)
logging.level.javax.management=WARN
logging.level.javax.management.mbeanserver=WARN
logging.level.sun.rmi=WARN
logging.level.java.management=WARN

# Spring Boot Actuator logging
logging.level.org.springframework.boot.actuate=WARN

# HTTP connection logging
logging.level.sun.net.www.protocol.http=WARN

# Redisson Redis client logging
logging.level.org.redisson=WARN

# Console pattern với màu sắc và thời gian
logging.pattern.console=%clr([%d{yyyy-MM-dd HH:mm:ss.SSS}]){green} %clr([%-5level]){magenta} %clr(%logger{0}){cyan} - %clr(%msg){default}%n
spring.output.ansi.enabled=always

logging.pattern.file=%d{yyyy-MM-dd HH:mm:ss} [%t] %-5level [%logger{0}] - %msg%n

# Security specific logging file location
logging.file.name=../logs/security-application.log
logging.file.max-size=10MB
logging.file.max-history=5

# Security Configuration - Disable CSRF completely
spring.security.csrf.disable=true

# Additional security configurations
spring.security.user.name=admin
spring.security.user.password=admin

# ========================================
# IP BLOCKING CONFIGURATION
# ========================================
# Enable/Disable IP blocking
security.ip.blocking.enabled=true
# Mode: "whitelist" (chỉ cho phép IP trong whitelist) hoặc "blacklist" (chặn IP trong blacklist)
security.ip.blocking.mode=blacklist
# IP Whitelist (static, từ properties) - Format: IP1,IP2,IP3 hoặc CIDR (192.168.1.0/24) hoặc wildcard (192.168.1.*)
# Ví dụ: 127.0.0.1,192.168.1.0/24,10.0.0.*
security.ip.whitelist=127.0.0.1,::1
# IP Blacklist (static, từ properties) - Format: IP1,IP2,IP3
# Ví dụ: 192.168.100.1,10.0.0.100
security.ip.blacklist=
# Endpoints được bypass IP blocking hoàn toàn (không check gì cả) - cho health check, internal APIs
security.ip.geo.bypass.endpoints=/auth/internal/**
# Endpoints dùng policy linh hoạt (chỉ block manual blacklist, không block auto-blacklist)
# Mục đích: Cho phép legitimate users đăng ký/đăng nhập ngay cả khi bị auto-block tạm thời
security.ip.geo.relaxed.endpoints=/auth/register,/auth/login

# ========================================
# AUTO-BLOCKING CONFIGURATION
# ========================================
# Enable/Disable auto-blocking (tự động blacklist khi IP vi phạm nhiều lần)
security.ip.auto-block.enabled=true
# Threshold: Nếu số lần IP bị block vượt threshold thì tự động blacklist
security.ip.auto-block.threshold=20
# Duration: Thời gian auto-blacklist (tạm thời, sẽ tự động expire)
# Format: số + đơn vị (s=seconds, m=minutes, h=hours, d=days)
# Ví dụ: 24h = 24 giờ, 7d = 7 ngày
security.ip.auto-block.duration=24h
# Escalate threshold: Số lần bị block để escalate lên admin (log warning)
security.ip.auto-block.escalate-threshold=50
# Phân biệt auto-blacklist (có TTL) và manual blacklist (permanent)
# Auto-blacklist sẽ tự động expire sau duration
# Manual blacklist (qua admin API) sẽ không expire

# ========================================
# GEO BLOCKING CONFIGURATION
# ========================================
# Enable/Disable Geo blocking (chặn theo quốc gia)
security.geo.blocking.enabled=false
# Mode: "whitelist" (chỉ cho phép countries trong whitelist) hoặc "blacklist" (chặn countries trong blacklist)
security.geo.blocking.mode=blacklist
# Country codes bị block (static, từ properties) - Format: COUNTRY_CODE1,COUNTRY_CODE2 (ISO 3166-1 alpha-2)
# Ví dụ: CN,RU,KR (China, Russia, South Korea)
security.geo.blocked.countries=
# Country codes được phép (static, từ properties) - Format: COUNTRY_CODE1,COUNTRY_CODE2
# Ví dụ: US,GB,CA (United States, United Kingdom, Canada)
security.geo.allowed.countries=
# API endpoint để detect country từ IP (ip-api.com - miễn phí, không cần key)
# {ip} sẽ được thay thế bằng IP address thực tế
security.geo.api.url=http://ip-api.com/json/{ip}?fields=status,countryCode,country
